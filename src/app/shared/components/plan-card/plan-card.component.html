<div class="relative w-full h-full group">
    @if (esPopular()) {
    <div class="absolute -top-4 left-1/2 -translate-x-1/2 z-20">
        <div
            class="px-4 py-1.5 bg-gradient-to-r from-[#5a5c8c] via-[#9ca0c7] to-[#5a5c8c] dark:from-[#9ca0c7] dark:via-[#5a5c8c] dark:to-[#9ca0c7] rounded-full shadow-lg backdrop-blur-sm border border-white/20">
            <div class="flex items-center gap-1.5">
                <svg class="w-3 h-3 text-white animate-pulse" viewBox="0 0 16 16" fill="currentColor">
                    <path
                        d="M8 1L10.09 5.26L14.73 5.93L11.36 9.21L12.18 13.84L8 11.65L3.82 13.84L4.64 9.21L1.27 5.93L5.91 5.26L8 1Z" />
                </svg>
                <span class="text-white text-xs font-bold tracking-wider">MÁS POPULAR</span>
            </div>
        </div>
    </div>
    }

    <div
        class="relative w-full h-full rounded-3xl overflow-hidden transition-all duration-500 transform flex flex-col group-hover:-translate-y-1 group-hover:shadow-2xl bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl border border-gray-200/50 dark:border-gray-700/50 shadow-lg"
        [class.animate-stretch]="animarEstiramiento()">

        <div class="relative z-10 flex flex-col h-full p-5 transition-all duration-300 ease-out">
            <div class="flex flex-col items-center mb-4 flex-shrink-0">
                <div
                    class="w-14 h-14 rounded-2xl flex items-center justify-center mb-3 transition-all duration-500 transform group-hover:scale-110 group-hover:rotate-3 bg-gradient-to-br from-[#5a5c8c]/20 to-[#9ca0c7]/20 dark:from-[#5a5c8c]/30 dark:to-[#9ca0c7]/30 shadow-lg shadow-[#5a5c8c]/20">
                    @if (iconoTipo() === 'gratis') {
                    <!-- Icono Gratis: Regalo/Gift -->
                    <svg class="w-7 h-7 text-[#5a5c8c] dark:text-[#9ca0c7]" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 12 20 22 4 22 4 12"></polyline>
                        <rect x="2" y="7" width="20" height="5"></rect>
                        <line x1="12" y1="22" x2="12" y2="7"></line>
                        <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
                        <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
                    </svg>
                    } @else if (iconoTipo() === 'individual') {
                    <!-- Icono Individual: Usuario/Persona -->
                    <svg class="w-7 h-7 text-[#5a5c8c] dark:text-[#9ca0c7]" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    } @else if (iconoTipo() === 'pos') {
                    <!-- Icono POS: Caja registradora/Tienda -->
                    <svg class="w-7 h-7 text-[#5a5c8c] dark:text-[#9ca0c7]" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                        <line x1="12" y1="11" x2="12" y2="11"></line>
                        <line x1="8" y1="11" x2="8" y2="11"></line>
                        <line x1="8" y1="15" x2="8" y2="15"></line>
                        <line x1="12" y1="15" x2="12" y2="15"></line>
                    </svg>
                    } @else if (iconoTipo() === 'premium') {
                    <!-- Icono Premium: Corona/Estrella premium -->
                    <svg class="w-7 h-7 text-[#5a5c8c] dark:text-[#9ca0c7]" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z">
                        </path>
                        <circle cx="12" cy="12" r="3" fill="currentColor" opacity="0.3"></circle>
                    </svg>
                    } @else {
                    <!-- Icono Empresa: Edificio/Organización -->
                    <svg class="w-7 h-7 text-[#5a5c8c] dark:text-[#9ca0c7]" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 21h18"></path>
                        <path d="M5 21V7l8-4v18"></path>
                        <path d="M19 21V11l-6-4"></path>
                        <line x1="9" y1="9" x2="9" y2="9"></line>
                        <line x1="9" y1="12" x2="9" y2="12"></line>
                        <line x1="9" y1="15" x2="9" y2="15"></line>
                        <line x1="9" y1="18" x2="9" y2="18"></line>
                    </svg>
                    }
                </div>

                <h3 class="text-xl font-bold text-center mb-1.5 text-gray-900 dark:text-white">
                    {{ titulo() }}
                </h3>

                @if (subtitulo()) {
                <div
                    class="px-2.5 py-0.5 rounded-full text-xs font-semibold mb-3 bg-gray-100 dark:bg-white/10 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-white/20">
                    {{ subtitulo() }}
                </div>
                }

                <div class="flex flex-col items-center gap-0.5 mb-2">
                    <div class="flex items-baseline gap-1">
                        <span class="text-4xl font-black tracking-tight text-[#5a5c8c] dark:text-[#9ca0c7]">
                            {{ precioFormateado() }}
                        </span>
                        @if (periodo() && !precioFormateado().includes('Personalizado') &&
                        !precioFormateado().includes('Gratis')) {
                        <span class="text-xs text-gray-600 dark:text-gray-300 font-medium">
                            {{ periodo() }}
                        </span>
                        }
                    </div>
                    @if (precioTotal() > precioBase() && precioBase() > 0 && !precioTexto().includes('Personalizado')) {
                    <div
                        class="flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300">
                        <span class="text-[#5a5c8c]/70 dark:text-[#9ca0c7]/70">Base: ${{
                            precioBase().toLocaleString('es-MX', {
                            minimumFractionDigits: 2 }) }}</span>
                        <span class="text-green-600 dark:text-green-400 font-semibold">+${{ (precioTotal() -
                            precioBase()).toLocaleString('es-MX', { minimumFractionDigits: 2 }) }} extras</span>
                    </div>
                    }
                </div>

                @if (descripcion()) {
                <p
                    class="text-xs text-gray-600 dark:text-gray-300 text-center leading-snug mb-4">
                    {{ descripcion() }}
                </p>
                }
            </div>

            <div class="flex-1 flex flex-col min-h-0 mb-4">
                @if (caracteristicas().length > 0) {
                <div class="space-y-2">
                    @for (caracteristica of caracteristicas(); track $index) {
                    <div class="flex items-start gap-2.5">
                        @if (caracteristica.texto.includes('Con anuncios')) {
                        <!-- Icono de advertencia para "Con anuncios" -->
                        <div
                            class="w-4 h-4 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 bg-orange-100 dark:bg-orange-900/30">
                            <svg class="w-2.5 h-2.5 stroke-orange-600 dark:stroke-orange-400" viewBox="0 0 12 12"
                                fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 3v3m0 3h.01M11 6a5 5 0 11-10 0 5 5 0 0110 0z" />
                            </svg>
                        </div>
                        <span class="text-xs leading-snug font-medium text-orange-700 dark:text-orange-300">
                            {{ caracteristica.texto }}
                        </span>
                        } @else {
                        <!-- Icono de check para características normales -->
                        <div
                            class="w-4 h-4 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 bg-[#5a5c8c]/20 dark:bg-[#9ca0c7]/20">
                            <svg class="w-2.5 h-2.5 stroke-[#5a5c8c] dark:stroke-[#9ca0c7]" viewBox="0 0 12 12"
                                fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10 3L4.5 8.5L2 6" />
                            </svg>
                        </div>
                        <span class="text-xs leading-snug text-gray-900 dark:text-white"
                            [class.font-semibold]="caracteristica.destacada"
                            [class.text-[#5a5c8c]]="caracteristica.destacada"
                            [class.dark:text-[#9ca0c7]]="caracteristica.destacada">
                            {{ caracteristica.texto }}
                        </span>
                        }
                    </div>
                    }
                </div>
                }

                @if (complementos().length > 0) {
                <div class="mt-4 pt-3 border-t border-gray-200/30 dark:border-gray-700/30">
                    <div class="flex items-center gap-1.5 mb-2">
                        <svg class="w-3.5 h-3.5 text-[#5a5c8c] dark:text-[#9ca0c7]" viewBox="0 0 16 16" fill="none"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 6L8 2L2 6V12L8 16L14 12V6Z" />
                            <path d="M2 6L8 10L14 6" />
                        </svg>
                        <span
                            class="text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wide">
                            Complementos Opcionales
                        </span>
                    </div>
                    <div class="space-y-2">
                        @for (complemento of complementos(); track $index) {
                        <label
                            class="flex items-center gap-2 cursor-pointer group/complemento hover:bg-[#5a5c8c]/5 dark:hover:bg-[#9ca0c7]/10 rounded-lg p-1.5 -m-1.5 transition-colors duration-200">
                            <input type="checkbox" [checked]="estaSeleccionado($index)"
                                (change)="toggleComplemento($index)" class="sr-only" />
                            <div class="w-4 h-4 rounded border-2 flex items-center justify-center flex-shrink-0 transition-all duration-200"
                                [class]="estaSeleccionado($index)
                         ? 'bg-[#5a5c8c] border-[#5a5c8c] dark:bg-[#9ca0c7] dark:border-[#9ca0c7]'
                         : 'border-gray-300 dark:border-white/40 group-hover/complemento:border-[#5a5c8c] dark:group-hover/complemento:border-[#9ca0c7]'">
                                @if (estaSeleccionado($index)) {
                                <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                    stroke-width="3">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                                </svg>
                                }
                            </div>
                            <div class="flex-1 flex items-center justify-between gap-2 min-w-0">
                                <div class="flex items-center gap-2 flex-1 min-w-0">
                                    @if (complemento.tipoIcono) {
                                    <div class="w-4 h-4 flex-shrink-0 text-[#5a5c8c] dark:text-[#9ca0c7]">
                                        @switch (complemento.tipoIcono) {
                                        @case ('chat') {
                                        <!-- Icono Chat con pacientes -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('chat-interno') {
                                        <!-- Icono Chat interno de clínica -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('farmacia') {
                                        <!-- Icono Farmacia/Pills -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('telemedicina') {
                                        <!-- Icono Telemedicina/Video -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('reportes') {
                                        <!-- Icono Reportes/Graph -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('integracion') {
                                        <!-- Icono Integración/Link -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1">
                                            </path>
                                        </svg>
                                        }
                                        @case ('recompensas') {
                                        <!-- Icono Recompensas/Star -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('ventas') {
                                        <!-- Icono Ventas/Chart -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                        }
                                        @case ('marketing') {
                                        <!-- Icono Marketing/Megaphone -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('sms') {
                                        <!-- Icono SMS/Message -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('laboratorio') {
                                        <!-- Icono Laboratorio/Flask -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('ia') {
                                        <!-- Icono IA/Chip -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z">
                                            </path>
                                        </svg>
                                        }
                                        @case ('incluido') {
                                        <!-- Icono Incluido/Check Circle -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        }
                                        @case ('desarrollo') {
                                        <!-- Icono Desarrollo/Tools -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                                            </path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        }
                                        @case ('soporte') {
                                        <!-- Icono Soporte/Question Mark Circle -->
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                            </path>
                                        </svg>
                                        }
                                        }
                                    </div>
                                    }
                                    <span
                                        class="text-xs font-medium text-gray-900 dark:text-white group-hover/complemento:text-[#5a5c8c] dark:group-hover/complemento:text-[#9ca0c7] transition-colors truncate">
                                        {{ complemento.texto }}
                                    </span>
                                </div>
                                @if (complemento.precio > 0) {
                                <span
                                    class="text-xs font-semibold text-[#5a5c8c] dark:text-[#9ca0c7] bg-[#5a5c8c]/10 dark:bg-[#9ca0c7]/20 px-1.5 py-0.5 rounded flex-shrink-0">
                                    +${{ complemento.precio.toLocaleString('es-MX') }}{{ periodo() ? '/mes' : '' }}
                                </span>
                                } @else {
                                <span
                                    class="text-xs font-semibold text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 px-1.5 py-0.5 rounded flex-shrink-0">
                                    Incluido
                                </span>
                                }
                            </div>
                        </label>
                        }
                    </div>
                </div>
                }
            </div>

            <button 
                [disabled]="botonDeshabilitado()"
                (click)="onBotonClick()"
                class="w-full h-11 rounded-2xl font-bold text-sm tracking-wide transition-all duration-300 transform cursor-pointer hover:scale-[1.02] active:scale-[0.98] bg-gradient-to-r from-[#5a5c8c] to-[#9ca0c7] dark:from-[#9ca0c7] dark:to-[#5a5c8c] hover:from-[#5a5c8c] hover:to-[#9ca0c7] text-white shadow-lg shadow-[#5a5c8c]/30 dark:shadow-[#9ca0c7]/30 hover:shadow-xl hover:shadow-[#5a5c8c]/50 dark:hover:shadow-[#9ca0c7]/50 disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0">
                {{ textoBoton() }}
            </button>
        </div>
    </div>
</div>

